{% extends 'base.html' %}

{% block extra_css %}
<style>
    /* Discord Embed Style Adaptation */
    .discord-embed {
        background: rgba(0, 0, 0, 0.3);
        border-left: 4px solid #00d2ff;
        border-radius: 4px;
        padding: 15px;
        margin-top: 10px;
        font-size: 0.85rem;
    }
    .embed-title { font-weight: 700; color: white; margin-bottom: 8px; }
    .embed-desc { color: rgba(255,255,255,0.7); line-height: 1.4; }
    .action-bar { display: flex; gap: 10px; margin-bottom: 10px; }
    .action-btn {
        font-size: 0.8rem; padding: 4px 10px; border-radius: 4px;
        background: rgba(255, 255, 255, 0.1); color: white; text-decoration: none; transition: 0.2s;
    }
    .action-btn:hover { background: #00d2ff; color: #000; }
</style>
{% endblock %}

{% block content %}
<div class="mb-4 d-flex justify-content-between align-items-center">
    <div>
        <h2 class="fw-bold">Panel Management</h2>
        <p class="text-white-50">Kelola tampilan panel dan embed di Discord server.</p>
    </div>
    <form action="/panel/action" method="POST" class="d-inline">
        <button type="submit" name="action" value="refresh_status" class="btn btn-glass"><i class="fas fa-sync me-2"></i> Refresh Status</button>
    </form>
</div>

<div class="row g-4">
    <!-- 1. Admin Dashboard Panel -->
    <div class="col-md-4">
        <div class="glass-card h-100 d-flex flex-column">
            <div class="d-flex justify-content-between mb-3">
                <h5 class="fw-bold"><i class="fas fa-user-shield me-2"></i>Admin Dashboard</h5>
                <button class="btn btn-sm btn-glass" onclick="editPanel('dashboard', `{{ panels.dashboard.title }}`, `{{ panels.dashboard.description }}`)"><i class="fas fa-edit"></i> Edit</button>
            </div>
            <p class="text-white-50 small">Panel kontrol pusat untuk admin mengelola patungan, verifikasi pembayaran, dan settings.</p>
            
            <div class="discord-embed mb-3">
                <div class="embed-title">{{ panels.dashboard.title }}</div>
                <div class="embed-desc">
                    {{ panels.dashboard.description | replace('\n', '<br>') | safe }}
                </div>
            </div>

            <div class="mt-auto">
                <form action="/panel/action" method="POST">
                    <button type="submit" name="action" value="send_dashboard" class="btn btn-sm btn-glass w-100 mb-2"><i class="fas fa-paper-plane me-2"></i>Kirim Ulang Panel</button>
                </form>
                <div class="text-center"><small class="text-white-50">Channel: #admin-dashboard</small></div>
            </div>
        </div>
    </div>

    <!-- 2. List PTPT Panel -->
    <div class="col-md-4">
        <div class="glass-card h-100 d-flex flex-column">
            <div class="d-flex justify-content-between mb-3">
                <h5 class="fw-bold"><i class="fas fa-list-ul me-2"></i>List PTPT</h5>
                <span class="badge bg-success">Live Update</span>
            </div>
            <p class="text-white-50 small">List otomatis yang menampilkan status real-time semua patungan aktif.</p>
            
            <div class="discord-embed mb-3" style="border-left-color: #2ecc71;">
                <div class="embed-title">üî• V1 - 24 Jam</div>
                <div class="embed-desc">
                    `1.` User1 - || @User1 || (PAID) ‚úÖ<br>
                    `2.` User2 - || @User2 || (BOOKED) ‚å®Ô∏è<br>
                    ...<br><br>
                    üìú **Script:** ‚úÖ Yes<br>
                    üöÄ **Start:** Full Slot
                </div>
            </div>

            <div class="mt-auto">
                <form action="/panel/action" method="POST">
                    <button type="submit" name="action" value="refresh_list" class="btn btn-sm btn-glass w-100 mb-2"><i class="fas fa-sync-alt me-2"></i>Force Refresh List</button>
                </form>
                <div class="text-center"><small class="text-white-50">Channel: #list-ptpt-x8</small></div>
            </div>
        </div>
    </div>

    <!-- 3. Ticket PTPT Panel -->
    <div class="col-md-4">
        <div class="glass-card h-100 d-flex flex-column">
            <div class="d-flex justify-content-between mb-3">
                <h5 class="fw-bold"><i class="fas fa-ticket-alt me-2"></i>Ticket Panel</h5>
                <button class="btn btn-sm btn-glass" onclick="editPanel('ticket', `{{ panels.ticket.title }}`, `{{ panels.ticket.description }}`)"><i class="fas fa-edit"></i> Edit</button>
            </div>
            <p class="text-white-50 small">Panel utama bagi user untuk membuat ticket order baru.</p>
            
            <div class="discord-embed mb-3" style="border-left-color: #3498db;">
                <div class="embed-title">{{ panels.ticket.title }}</div>
                <div class="embed-desc">
                    {{ panels.ticket.description | replace('\n', '<br>') | safe }}
                </div>
            </div>

            <div class="mt-auto">
                <form action="/panel/action" method="POST">
                    <button type="submit" name="action" value="send_ticket" class="btn btn-sm btn-glass w-100 mb-2"><i class="fas fa-paper-plane me-2"></i>Kirim Ulang Panel</button>
                </form>
                <div class="text-center"><small class="text-white-50">Channel: #open-ticket</small></div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editPanelModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glass-card border-0">
            <div class="modal-header border-bottom border-secondary">
                <h5 class="modal-title">Edit Panel Content</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/save_panel" method="POST">
                <div class="modal-body">
                    <input type="hidden" name="panel_type" id="panel_type">
                    <div class="mb-3">
                        <label class="form-label">Embed Title</label>
                        <input type="text" class="form-control bg-transparent text-white" name="title" id="panel_title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Embed Description</label>
                        <textarea class="form-control bg-transparent text-white" name="description" id="panel_desc" rows="8" required></textarea>
                        <small class="text-white-50">Support Markdown Discord (**bold**, *italic*, dll)</small>
                    </div>
                </div>
                <div class="modal-footer border-top border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editPanel(type, title, desc) {
    document.getElementById('panel_type').value = type;
    document.getElementById('panel_title').value = title;
    document.getElementById('panel_desc').value = desc;
    new bootstrap.Modal(document.getElementById('editPanelModal')).show();
}
</script>
{% endblock %}
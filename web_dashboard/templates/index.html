<!-- templates/index.html -->
{% extends 'base.html' %}

{% block content %}
<!-- Header -->
<div class="mb-4">
    <h1 class="fw-bold">Dashboard</h1>
    <p class="text-secondary">Overview of your server data and statistics.</p>
</div>

<div class="row g-4">
    <!-- Row 1: Server Info -->
    <div class="col-12">
        <div class="custom-card d-flex align-items-center gap-3">
            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--glass-border); font-weight: bold;">DVN</div>
            <div>
                <h4 class="mb-0 fw-bold">DivineBlox Community</h4>
                <span class="badge bg-info text-dark">PREMIUM PLAN</span>
            </div>
        </div>
    </div>

    <!-- Row 2: Stats -->
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-accent">{{ pending|length }}</div>
            <div class="stat-label">Pending Payments</div>
            <i class="fas fa-clock position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-green">{{ commands|length }}</div>
            <div class="stat-label">Custom Commands</div>
            <i class="fas fa-terminal position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-red">Rp {{ "{:,}".format(omzet) }}</div>
            <div class="stat-label">Total Omzet</div>
            <i class="fas fa-wallet position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-primary">{{ total_tickets }}</div>
            <div class="stat-label">Total Tickets</div>
            <i class="fas fa-ticket-alt position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-warning">{{ open_tickets }}</div>
            <div class="stat-label">Open Tickets</div>
            <i class="fas fa-envelope-open-text position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="custom-card">
            <div class="stat-value text-info">{{ total_services }}</div>
            <div class="stat-label">Total Services</div>
            <i class="fas fa-server position-absolute top-0 end-0 m-4 text-secondary opacity-25 fa-2x" style="pointer-events: none;"></i>
        </div>
    </div>

    <!-- Row 3: Charts -->
    <div class="col-md-6">
        <div class="custom-card">
            <h6 class="mb-3 fw-bold">Ticket Distribution</h6>
            <div style="height: 300px;"><canvas id="chart1"></canvas></div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="custom-card">
            <h6 class="mb-3 fw-bold">Weekly Activity</h6>
            <div style="height: 300px;"><canvas id="chart2"></canvas></div>
        </div>
    </div>

    <!-- Row 4: Approval Table (Tetap di Home sebagai Overview) -->
    <div class="col-12">
        <div class="custom-card">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0 fw-bold"><i class="fas fa-money-bill-wave text-accent me-2"></i>Approval Pembayaran</h5>
                <span class="badge bg-secondary">{{ pending|length }} Pending</span>
            </div>
            
            {% if pending %}
            <div class="table-responsive">
                <table class="table table-dark-custom align-middle">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Nominal</th>
                            <th>Bukti</th>
                            <th class="text-end">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in pending %}
                        <tr>
                            <td>
                                <div class="fw-bold">{{ p.username }}</div>
                                <small class="text-secondary">ID: {{ p.id }}</small>
                            </td>
                            <td class="text-accent fw-bold">Rp {{ "{:,}".format(p.amount) }}</td>
                            <td>
                                <a href="{{ p.proof_url }}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-image"></i> Lihat
                                </a>
                            </td>
                            <td class="text-end">
                                <form action="/approve/{{ p.id }}" method="POST" class="d-inline">
                                    <button class="btn btn-sm btn-success"><i class="fas fa-check"></i></button>
                                </form>
                                <form action="/reject/{{ p.id }}" method="POST" class="d-inline">
                                    <button class="btn btn-sm btn-danger"><i class="fas fa-times"></i></button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5 text-secondary">
                <i class="fas fa-check-circle fa-3x mb-3 opacity-50"></i>
                <p>Tidak ada pembayaran pending.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart Config
    Chart.defaults.color = 'rgba(255, 255, 255, 0.7)';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

    new Chart(document.getElementById('chart1'), {
        type: 'doughnut',
        data: {
            labels: ['Paid', 'Pending', 'Rejected'],
            datasets: [{
                data: [{{ paid_count }}, {{ pending|length }}, {{ rejected_count }}],
                backgroundColor: ['#00ff88', '#00d2ff', '#ff4b4b'],
                borderWidth: 0
            }]
        },
        options: { maintainAspectRatio: false, cutout: '70%' }
    });

    new Chart(document.getElementById('chart2'), {
        type: 'bar',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Transactions',
                data: [12, 19, 3, 5, 2, 3, 10],
                backgroundColor: '#00d2ff',
                borderRadius: 4
            }]
        },
        options: { maintainAspectRatio: false, scales: { x: { grid: { display: false } } } }
    });
</script>
{% endblock %}
